<p>Please click on the thumbnail(s) to see the full version of the diagram in PNG format - or see the 'Downloads' tab for more, high-quality options.</p>
<table>
  <tr>
  <% #print out the psipred diagrams if found
   hDiagramNames = Hash.new{|h,k| h[k]=Hash.new(&h.default_proc) }
   results.each do |job_state|
     if (job_state.status_class == 14)
        if job_state.content_name =~ /.+_(\d+)\.png/
        hDiagramNames[$1]["url"] = url_for(:controller => "bio_serf", :action => "getresultattached", :id => job_state.id)
        hDiagramNames[$1]["thumb"] = url_for(:controller => "bio_serf", :action => "getthumbnail", :id => job_state.thumbnails.first.id)
        hDiagramNames[$1]["id"] = job_state.id
     end
    end
   end
   hDiagramNames.keys.sort.each_with_index do |order,index| %>
        <td><a href="http://<%= hostname%>/<%= h(@service_name) %>/image/?imageid=<%= hDiagramNames[order]["id"] %>" target="_blank"><img class="thumbnail" src="<%= hDiagramNames[order]["thumb"] %>" /></a></td>
        <% if index > 0 %>
          <% if index.modulo(3) == 2 %>
            </tr><tr>
          <% end %>
        <% end %>

     <% end %>
   </tr>
   </table>