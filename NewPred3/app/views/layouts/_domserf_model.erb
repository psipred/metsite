<table>
<tr><td>
    <% results.each do |job_state| %>
        <% if (job_state.status_class == 6) %>
                    <% if job_state.content_name =~ /^No model/ %>
                    <h2><%= job_state.content_name %></h2>
                     <%  else %>
                    	<% if job_state.content_name =~ /_(\d+)_(\d+)\.pdb/ %>
                    		<h2>Domain for residues <%= $1 %> to <%= $2 %></h2>
                    	<% end %>
                    	<%= render :partial => 'layouts/pdb_result', :locals => {:pdb_result => job_state, :bgcolor => "#ccc"} %>
                    <% end %>
         <% end %>
     <% end %>
     
     <% results.each do |job_state| %>
        <% if (job_state.status_class == 96) %>
        <h3>Templates</h3>
        <table class="tablesorter" id="DomserfTable2"  width="100%" cellspacing="0" cellpadding="2">
          <thead>
            <tr>
              <th align="center">PDB Chain</th>
              <th width="14%" align="center">Cath ID</th>
              <th width="14%" align="center">Algorithm</th>
              <th width="14%" align="right">Query Start</th>
              <th width="14%" align="right">Query Stop</th>
              <th width="14%" align="right">E Value</th>
           </tr>
         </thead>
         <tbody>
      	 <% lines = job_state.data.split(/\n/)
      	    lines.each do | line | %>
      	 		<tr> 
      	 		<% entries = line.split(/\s+/)
      	 		pdb = ''
      	 		type = ''
      	 		cathdom = '' 
      	 		start = 0
      	 		stop = 0
      	 		if entries[1] =~ /(.+)\|(.{4})(.+):/
      	 			pdb = $2
      	 			type = $1
      	 			cathdom = $2+$3
      	 		end
      	 		eval = entries[10]
      	 		if entries[14] =~ /(\d+):(\d+)/
      	 			start = $1
      	 			stop = $2
      	 		end
      	 		if type =~ /CDOM/
      	 			type = "PSIBLAST"
      	 		else
      	 			type = "pDomThreader"
      	 		end
      	 		 %>
      	 		 <td align="right"><%= pdb %></td><td align="right"><%= cathdom %></td><td align="right"><%= type %></td><td align="right"><%= start %></td><td align="right"><%= stop %></td><td align="right"><%= eval %></td>
      	 		</tr>
      	 	<% end %> 
         </tbody>
      </table>
      	 <% end %>
     <% end %>
     
     <% results.each do |job_state| %>
        <% if (job_state.status_class == 95) %>
        <h3>Templates</h3>
        <table class="tablesorter" id="DomserfTable"  width="100%" cellspacing="0" cellpadding="2">
          <thead>
            <tr>
              <th align="center">PDB Chain</th>
              <th width="14%" align="center">Cath ID</th>
              <th width="14%" align="right">Query Start</th>
              <th width="14%" align="right">Query Stop</th>
              <th width="14%" align="right">Subject Start</th>
              <th width="14%" align="right">Subject Stop</th>
              <th width="14%" align="right">E Value</th>
           </tr>
         </thead>
         <tbody>
      	 <% lines = job_state.data.split(/\n/)
      	 	lines.each_with_index do | line, i |
      	 		if i == 0
      	 			next
      	 		else %>
      	 			<tr> 
      	 		<%	entries = line.split(/,/)
      	 			entries.each do | field |
      	 				%><td align="right"><%= field %></td> <%		
      	 			end
      	 		end %>
      	 		</tr>
      	 	<% end %> 
         </tbody>
      </table>
        <% end %>
     <% end %>
     
     <% results.each do |job_state| %>
        <% if (job_state.status_class == 92) %>
        	<h2><%= job_state.content_name %></h2>
        <% end %>
     <% end %>
     
     <% results.each do |job_state| %>
        <% if (job_state.status_class == 93) %>
        	<h2><%= job_state.status %>.</h2>
        <% end %>
     <% end %>
     
     <% results.each do |job_state| %>
        <% if (job_state.status_class == 94) %>
        	<h2><%= job_state.status %>.</h2>
        <% end %>
     <% end %>
     
     
</td></tr>
</table>
